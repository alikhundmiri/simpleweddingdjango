{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<!-- <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors"> -->
	
	<title>{% block title %}Simple Wedding Movement{% endblock %}</title>


	{% block meta_tags %}{% endblock %}

	<!-- Favicons -->
	<link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicons/apple-touch-icon.png' %}">
	<link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicons/favicon-32x32.png' %}">
	<link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicons/favicon-16x16.png' %}">
	<link rel="manifest" href="{% static 'favicons/site.webmanifest' %}">
	
	<!-- Font Awesome -->
	<script src="https://kit.fontawesome.com/4af485e413.js" crossorigin="anonymous"></script>

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

	{% block head_extras %}{% endblock %}
	<link href="https://fonts.googleapis.com/css2?family=Katibeh&display=swap" rel="stylesheet">
	<style type="text/css">

		.arabic-text{
			font-family: 'Katibeh', cursive;
			font-size: 40px;
		}

		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		@media (min-width: 768px) {
			.bd-placeholder-img-lg {
				font-size: 3.5rem;
			}
		}
		
		.video-container {
			position: relative;
			width: 100%;
			height: 0;
			padding-bottom: 56.25%;
			margin-bottom: 30px;
		}
		.youtube-video {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
	</style>
	<!-- Custom styles for this template -->
	<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
	<!-- Custom styles for this template -->
	<link href="{% static 'base_v2/blog.css' %}" rel="stylesheet">

	{% if production %}
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-158060116-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-158060116-1');
	</script>
	{% endif %}

</head>
<body>
	<div class="container">
		<!-- Collective Header -->
		<!-- navbar -->
		{% include 'navbar_v2.html' %}

		<!-- Picker -->
		{% include 'picker_v2.html' %}

		<!-- website content -->
		{% block welcome_content %}
		{% endblock %}
	</div>

	<main role="main" class="container">
		<div class="row">
			<div id='content' class="col-md-8 blog-main">
				{% block content %}
				{% endblock %}
			</div><!-- /.blog-main -->

			<aside class="col-md-4 blog-sidebar">
				{% include 'snippet_about_us_v2.html' %}
				<!-- {% include 'snippet_archives_v2.html' %} -->
				<!-- {% include 'snippet_social_v2.html' %} -->
			</aside><!-- /.blog-sidebar -->

		</div><!-- /.row -->

	</main><!-- /.container -->

	<!-- Footer -->
	<div class="col-12 blog-footer">
		{% include 'footer.html' %}
	</div><!-- /.Footer -->
	<!-- Bootstrap core JavaScript -->
	<!-- <script src="vendor/jquery/jquery.slim.min.js"></script> -->
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>

	<!-- <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script> -->
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

	<!-- 	<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.8.2/marked.min.js" integrity="sha256-6Om9HYjLO4iZmEyM/7oAv7GW1WzACqQ4PV51bTgnioI=" crossorigin="anonymous"></script>
	-->
	<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.min.js' type="text/javascript"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.0.11/purify.min.js" type="text/javascript"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

	<script type="text/javascript">
		$(document).ready(function(){
			// convert Q2:255 mentions into quran text.
			// DONE 1. use regex to find all mentions
			// DONE 2. get the numbers 2:225
			// DONE 3. fetch API http://api.alquran.cloud/v1/ayah/2:255
			// 4. store api into custom DM
			// DONE 5. replace text Q2:255 into arabic text
			var quran_regex = /Q([0-9]:[0-9])\w+/g;

			// document.body.innerHTML = document.body.innerHTML.replace(quran_regex, "Quran text here");
			
			// ENABLE THIS TO TEST
			// document.body.innerHTML = document.body.innerHTML.replace(quran_regex, aiyath_writer);

			function aiyath_writer(aiyath) {
				// within the function, start a fetch api
				var arabic_text;
				// an ajax api fetch
				$.ajax({

					type: "GET", // set the type, url and dataType
					async: false,
					url: 'http://api.alquran.cloud/v1/ayah/'+aiyath.replace(/[Q]/,''),
					dataType: "json",
					// if success, do the following function
					success: function (data) {
						arabic_text = data['data']['text']
						console.log(arabic_text); // <= this works
						
					},
					// if error, log it.
					error: function (error) {
						console.log(error);
						return error;
					}
				});
				
				return_format = '<p class="arabic-text" dir="rtl" lang="ar">'+arabic_text+'</p>'
				
				return return_format
			}


			// making the content space full height. fill up device;'s space.
			var screen_height = screen.height + "px";
			// console.log(screen_height);
			document.getElementById("content").style.minHeight = screen_height;

			// content markdown for blogs details and blog editor preview
			$('.content-markdown').each(function(){



				var content = $(this).text()
				// console.log(content);
				var converter = new showdown.Converter();
				// var markedContent = marked(content); /*not using marked*/
				html = converter.makeHtml(content);
				// console.log(html);
				var sanitisedMarkedContent = DOMPurify.sanitize(html);
				// console.log(sanitisedMarkedContent);

				// $(this).innerHTML(sanitisedMarkedContent)
				$(this).html(sanitisedMarkedContent);
				// console.log(sanitisedMarkedContent)
				$("#preview-content img").each(function(){
					$(this).addClass('custom-img-responsive');
				});
			})

			var titleInput = $("#id_title")
			function setTitle(value){
				$("#preview-title").text(value)
			}

			setTitle(titleInput.val())
			titleInput.keyup(function(){
				var newTitle = $(this).val()
				setTitle(newTitle)
			})


			var contentInput = $("#wmd-input-id_detail")
			function setContent(value){
				var markedContent = marked(value)
				$("#preview-content").html(markedContent)
				$("#preview-content img").each(function(){
					$(this).addClass('img-responsive')
				})
			}
			setContent(contentInput.val())
			contentInput.keyup(function(){
				var newContent = $(this).val()
				setContent(newContent)
			})
			
		})
	</script>
</body>
</html>
